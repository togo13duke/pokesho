# Feature Specification: ポケモン将棋

**Feature Branch**: `001-3x4-2`
**Created**: 2025-10-01
**Status**: Draft
**Input**: User description: "ポケモン将棋を開発する。どうぶつしょうぎのルールベースで、3x4の盤面上で対戦する2人用ゲーム。駒はピカチュウ（王将/全方向移動）、フシギダネ（斜め移動）、ゼニガメ（縦横移動）、ヒトカゲ（前進のみ、相手陣でリザードンに進化）。相手のピカチュウを取るか、自分のピカチュウでトライすると勝利。取った駒は手駒として使用可能。ターン表示、手駒表示エリア、移動可能マスのハイライト機能を含む。"

---

## ⚡ Quick Guidelines
- ✅ Focus on WHAT users need and WHY
- ❌ Avoid HOW to implement (no tech stack, APIs, code structure)
- 👥 Written for business stakeholders, not developers

---

## Clarifications

### Session 2025-10-01
- Q: ゲーム終了後、新しいゲームを開始する方法は？ → A: リスタートボタンを画面に表示する
- Q: 駒を選択した後、移動可能なマスが存在しない場合の表示方法は？ → A: ハイライトなし（何も表示しない）
- Q: 手駒を配置しようとしたが、盤上に空きマスがない場合の動作は？ → A: 手駒配置を無効化（クリックできない）
- Q: PokeAPI から画像取得に失敗した場合の動作は？ → A: デフォルト画像（プレースホルダー）を表示
- Q: 初回ロード時のポケモン画像取得の最大待機時間は？ → A: 5秒（5秒以内にロード完了）

---

## User Scenarios & Testing

### Primary User Story

2人のプレイヤーがブラウザ上でポケモン将棋を楽しむ。ゲーム開始時、3×4マスの盤面に各プレイヤーの駒（ピカチュウ、フシギダネ、ゼニガメ、ヒトカゲ）が初期配置される。プレイヤーは交互にターンを実行し、自分の駒を選択して移動可能なマスに移動させる。相手の駒を取った場合は手駒として保持し、後で盤上に配置できる。ヒトカゲが相手陣地の最奥行に到達すると自動的にリザードンに進化し、動きが強化される。相手のピカチュウを取得するか、自分のピカチュウが相手陣地の最奥行に到達（トライ）するとゲームに勝利し、勝敗メッセージが表示される。

### Acceptance Scenarios

1. **Given** ゲーム開始時の初期配置状態、**When** 先手プレイヤーが自分のヒトカゲを選択、**Then** 前方1マスがハイライト表示され、そのマスをクリックすると駒が移動する

2. **Given** ヒトカゲが移動可能なマスに相手の駒がある状態、**When** ヒトカゲでそのマスに移動、**Then** 相手の駒が取られ、自分の手駒エリアに追加される

3. **Given** 手駒を持っている状態、**When** 自分のターンで空きマスをクリック、**Then** 手駒を盤上に配置できる

4. **Given** ヒトカゲが相手陣地の最奥行に到達、**When** そのマスに移動完了、**Then** ヒトカゲの画像がリザードンに変わり、移動パターンが拡張される

5. **Given** ゲーム進行中、**When** プレイヤーが相手のピカチュウを取る、**Then** 「○○の勝利！」メッセージが表示され、ゲームが終了する

6. **Given** ゲーム進行中、**When** 自分のピカチュウが相手陣地の最奥行に到達（トライ）、**Then** 「○○の勝利！」メッセージが表示され、ゲームが終了する

### Edge Cases

- PokeAPI からの画像取得に失敗した場合、デフォルトのプレースホルダー画像を表示してゲームを続行可能にする
- 初回ロード時、5秒以内に画像取得が完了しない場合はタイムアウトしてプレースホルダー画像でゲームを開始する
- 同じ盤面状態が繰り返される千日手は今回のスコープ外として扱う

## Requirements

### Functional Requirements

#### 盤面とゲーム初期化
- **FR-001**: システムは3×4マスの盤面を表示しなければならない
- **FR-002**: システムはゲーム開始時に以下の初期配置を行わなければならない
  - 各プレイヤー側の中央にピカチュウ
  - ピカチュウの左にフシギダネ、右にゼニガメ
  - 前列中央にヒトカゲ
- **FR-003**: システムは先手と後手を区別し、初期状態では先手のターンから開始しなければならない

#### 駒の移動ルール
- **FR-004**: ピカチュウは全方向（上下左右斜め）に1マス移動できなければならない
- **FR-005**: フシギダネは斜め方向に1マス移動できなければならない
- **FR-006**: ゼニガメは縦横方向に1マス移動できなければならない
- **FR-007**: ヒトカゲは前方1マスのみ移動できなければならない
- **FR-008**: リザードン（進化後のヒトカゲ）は前方・後方・左右・斜め前方に1マス移動できなければならない

#### ユーザーインタラクション
- **FR-009**: プレイヤーが駒を選択したとき、その駒が移動可能なマスを視覚的にハイライト表示しなければならない
- **FR-009-1**: 選択した駒に移動可能なマスが存在しない場合、ハイライトは一切表示しない
- **FR-010**: プレイヤーはハイライトされたマスをクリックすることで駒を移動できなければならない
- **FR-011**: 現在のターン（先手の番/後手の番）を常に画面上に表示しなければならない
- **FR-012**: ターンが切り替わるたびにターン表示を更新しなければならない

#### 駒の取得と手駒システム
- **FR-013**: プレイヤーが相手の駒がいるマスに移動したとき、相手の駒を取得しなければならない
- **FR-014**: 取得した駒は自分の手駒として保持し、手駒表示エリアに表示しなければならない
- **FR-015**: 手駒表示エリアは先手用と後手用で分けて表示しなければならない
- **FR-016**: プレイヤーは自分のターンで手駒を盤上の空きマスに配置できなければならない
- **FR-016-1**: 盤上に空きマスが存在しない場合、手駒はクリックできない状態にしなければならない

#### 成り（進化）システム
- **FR-017**: ヒトカゲが相手陣地の最奥行（先手なら1行目、後手なら4行目）に到達したとき、自動的にリザードンに進化しなければならない
- **FR-018**: 進化時には駒の画像をヒトカゲからリザードンに変更しなければならない
- **FR-019**: 進化後の駒の移動パターンはリザードンのルール（FR-008）に従わなければならない

#### 勝敗判定
- **FR-020**: プレイヤーが相手のピカチュウを取得したとき、そのプレイヤーの勝利としなければならない
- **FR-021**: プレイヤーのピカチュウが相手陣地の最奥行に到達（トライ）したとき、そのプレイヤーの勝利としなければならない
- **FR-022**: 勝敗が決定したとき、勝者を示すメッセージを表示しなければならない
- **FR-023**: 勝敗判定後はゲームを終了し、それ以上の操作を受け付けないようにしなければならない
- **FR-024**: ゲーム終了時にリスタートボタンを表示し、クリックで新しいゲームを開始できなければならない

#### スコープ外機能
以下の機能は今回の実装範囲外とする:
- 待った機能（手を戻す機能）
- 棋譜の保存・再生
- CPU対戦
- 千日手判定
- オンライン対戦
- ユーザー認証

### Key Entities

- **盤面（Board）**: 3×4のマス目で構成され、各マスは駒を1つ配置可能。座標（行、列）で識別される
- **駒（Piece）**: ピカチュウ、フシギダネ、ゼニガメ、ヒトカゲ、リザードンの5種類。各駒は所有者（先手/後手）、種類、移動パターン、現在位置、画像URLまたはプレースホルダー情報を持つ
- **手駒（CapturedPieces）**: 取得した相手の駒のリスト。先手用と後手用で分けて管理される
- **ターン（Turn）**: 現在どちらのプレイヤーの番かを示す状態（先手/後手）
- **ゲーム状態（GameState）**: 進行中、先手勝利、後手勝利のいずれかの状態を持つ
- **画像キャッシュ（ImageCache）**: PokeAPIから取得した画像データまたはフォールバック用のプレースホルダー画像。取得失敗時または5秒タイムアウト時にはデフォルト画像を使用

### Non-Functional Requirements

#### パフォーマンス
- **NFR-001**: 初回ロード時のポケモン画像取得は5秒以内に完了しなければならない
- **NFR-002**: 5秒以内に完了しない場合はタイムアウトし、プレースホルダー画像でゲームを開始しなければならない
- **NFR-003**: 2回目以降のロード（キャッシュヒット時）は1秒以内にゲームを開始できなければならない

---

## Review & Acceptance Checklist

### Content Quality
- [x] No implementation details (languages, frameworks, APIs)
- [x] Focused on user value and business needs
- [x] Written for non-technical stakeholders
- [x] All mandatory sections completed

### Requirement Completeness
- [x] No [NEEDS CLARIFICATION] markers remain
- [x] Requirements are testable and unambiguous
- [x] Success criteria are measurable
- [x] Scope is clearly bounded
- [x] Dependencies and assumptions identified

---

## Execution Status

- [x] User description parsed
- [x] Key concepts extracted
- [x] Ambiguities marked
- [x] User scenarios defined
- [x] Requirements generated
- [x] Entities identified
- [x] Review checklist passed

---
