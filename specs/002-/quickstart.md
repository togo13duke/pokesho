# Quickstart - 後手の駒セット変更と初期配置の左右反転

**日付**: 2025-10-01
**対象機能**: 後手の駒セット変更と初期配置の左右反転

## 目的

この機能が正しく実装されたことを確認するための手順書です。すべてのステップが成功すれば、機能は要件を満たしています。

---

## 前提条件

- Node.js 18以上がインストールされていること
- プロジェクトの依存関係がインストール済み（`npm install`）
- 開発サーバーが起動可能な状態（`npm run dev`）

---

## 検証手順

### 1. 開発サーバーの起動

```bash
npm run dev
```

ブラウザで `http://localhost:5173` にアクセスします。

**期待結果**:
- ゲーム画面が表示される
- エラーが発生しない

---

### 2. 初期配置の確認

**操作**: ゲーム開始時の盤面を目視確認

**期待結果**:
- 先手（下段）後列: フシギダネ（左）- ピカチュウ（中央）- ゼニガメ（右）
- 先手（下段）前列: 中央にヒトカゲ
- 後手（上段）後列: クワッス（左）- テラパゴス（中央）- ニャオハ（右）
- 後手（上段）前列: 中央にホゲータ
- すべての駒にポケモン画像が表示されている（プレースホルダーまたはPokeAPIから取得した画像）

**検証ポイント**:
- FR-001: 後手はテラパゴス、ニャオハ、クワッス、ホゲータを使用
- FR-003: 先手と後手で、ぞう役（フシギダネ/ニャオハ）ときりん役（ゼニガメ/クワッス）の配置が左右逆
- FR-004: 先手と後手の駒が視覚的に区別可能

---

### 3. 駒の移動ルールの確認

#### 3.1 先手のピカチュウの移動

**操作**:
1. ピカチュウをクリック
2. ハイライトされた移動可能マスを確認

**期待結果**:
- 全方向（8方向）の隣接マスがハイライトされる

#### 3.2 後手のテラパゴスの移動

**操作**:
1. 先手のターンを終了（適当な駒を移動）
2. 後手のテラパゴスをクリック
3. ハイライトされた移動可能マスを確認

**期待結果**:
- 全方向（8方向）の隣接マスがハイライトされる
- ピカチュウと同じ移動ルール

**検証ポイント**:
- FR-006: 先手と後手で異なるポケモンセットを使用しても、各役職の移動ルールは同一

#### 3.3 その他の駒の移動ルール

| 駒 | 役職 | 移動方向 |
|----|------|----------|
| フシギダネ / ニャオハ | ぞう | 斜め4方向 |
| ゼニガメ / クワッス | きりん | 縦横4方向 |
| ヒトカゲ / ホゲータ | ひよこ | 前方1マス |

**操作**: それぞれの駒をクリックして移動可能マスを確認

**期待結果**: 表の通りに移動可能マスがハイライトされる

---

### 4. 進化機能の確認

#### 4.1 後手のホゲータの進化

**操作**:
1. 後手のホゲータを敵陣最奥行（Row 3）まで移動
2. 駒が進化することを確認

**期待結果**:
- ホゲータがラウドボーンに進化
- 画像がラウドボーンに変わる
- 移動ルールが「前後左右+斜め前」に変更される

**検証ポイント**:
- FR-002: 後手のホゲータが敵陣最奥行に到達したとき、ラウドボーンに進化

#### 4.2 先手のヒトカゲの進化

**操作**:
1. 先手のヒトカゲを敵陣最奥行（Row 0）まで移動
2. 駒が進化することを確認

**期待結果**:
- ヒトカゲがリザードンに進化
- 画像がリザードンに変わる

---

### 5. 駒の捕獲と変換

#### 5.1 後手の駒を先手が捕獲

**操作**:
1. 先手の駒で後手のホゲータを捕獲
2. 手駒エリアを確認

**期待結果**:
- 先手の手駒エリアにホゲータが表示される（変換されずそのまま）

**検証ポイント**:
- FR-005: 捕獲された駒は捕獲者の駒セットに変換される（同じひよこ役なので外見は変わらない）

#### 5.2 先手の駒を後手が捕獲

**操作**:
1. 後手の駒で先手のヒトカゲを捕獲
2. 手駒エリアを確認

**期待結果**:
- 後手の手駒エリアにホゲータが表示される（ヒトカゲがホゲータに変換）

**検証ポイント**:
- FR-005: 捕獲された駒は捕獲者の駒セットに変換される

#### 5.3 王将役の捕獲と変換

**操作**:
1. 先手の駒で後手のテラパゴスを捕獲
2. 手駒エリアを確認

**期待結果**:
- 先手の手駒エリアにピカチュウが表示される（テラパゴスがピカチュウに変換）

**検証ポイント**:
- FR-005: 捕獲された駒は捕獲者の駒セットに変換される（王将役 → 王将役）

#### 5.4 進化した駒の捕獲と変換

**操作**:
1. 後手のホゲータをラウドボーンに進化させる
2. 先手の駒でラウドボーンを捕獲
3. 手駒エリアを確認

**期待結果**:
- 先手の手駒エリアにヒトカゲ（進化前）が表示される

**検証ポイント**:
- FR-007: 進化した駒が捕獲された場合、進化前の状態に戻し、捕獲者の駒セットに変換

---

### 6. 手駒の配置

**操作**:
1. 手駒を持っている状態で、手駒エリアの駒をクリック
2. 空いているマスをクリックして配置

**期待結果**:
- 手駒が盤面に配置される
- 配置された駒は正しいプレイヤーの所有
- 配置された駒の画像が正しく表示される

---

### 7. 勝敗判定

#### 7.1 王将役の捕獲による勝利

**操作**:
1. 先手の駒で後手のテラパゴスを捕獲

**期待結果**:
- 「先手の勝利！」メッセージが表示される
- ゲームが終了する

#### 7.2 王将役の敵陣到達による勝利

**操作**:
1. 先手のピカチュウを敵陣最奥行（Row 0）まで移動

**期待結果**:
- 「先手の勝利！」メッセージが表示される
- ゲームが終了する

---

### 8. 画像の取得とキャッシュ

**操作**:
1. 初回ゲーム起動時、DevToolsのNetworkタブを開く
2. PokeAPIへのリクエストを確認
3. ページをリロード
4. 再度Networkタブを確認

**期待結果**:
- 初回: PokeAPIへのリクエストが10回（各ポケモンごと）
- 2回目: PokeAPIへのリクエストが0回（キャッシュから読み込み）

**検証ポイント**:
- FR-004: 各ポケモンの画像をPokeAPIから取得
- 憲法原則III: 2回目以降はキャッシュから読み込み、ネットワーク不要

---

### 9. エッジケースの確認

#### 9.1 PokeAPI取得失敗時のフォールバック

**操作**:
1. DevToolsでネットワークをオフラインに設定
2. キャッシュをクリア
3. ページをリロード

**期待結果**:
- プレースホルダー画像が表示される
- ゲームはプレイ可能

**検証ポイント**:
- FR-004: PokeAPIから画像が取得できない場合、フォールバック処理が動作

#### 9.2 すべての駒の変換ルール

**操作**: 以下のすべての組み合わせを確認

| 捕獲される駒 | 捕獲するプレイヤー | 変換後の駒 |
|------------|------------------|-----------|
| テラパゴス（王将） | 先手 | ピカチュウ（王将） |
| ピカチュウ（王将） | 後手 | テラパゴス（王将） |
| ニャオハ（ぞう） | 先手 | フシギダネ（ぞう） |
| フシギダネ（ぞう） | 後手 | ニャオハ（ぞう） |
| クワッス（きりん） | 先手 | ゼニガメ（きりん） |
| ゼニガメ（きりん） | 後手 | クワッス（きりん） |
| ホゲータ（ひよこ） | 先手 | ヒトカゲ（ひよこ） |
| ヒトカゲ（ひよこ） | 後手 | ホゲータ（ひよこ） |
| ラウドボーン（にわとり） | 先手 | ヒトカゲ（ひよこ） |
| リザードン（にわとり） | 後手 | ホゲータ（ひよこ） |

**期待結果**: すべての変換が正しく動作する

---

## ビルドとTypeScriptチェック

### 10. ビルド成功の確認

```bash
npm run build
```

**期待結果**:
- TypeScriptのエラーが0件
- ビルドが成功する
- `dist/` ディレクトリが生成される

### 11. Lintチェック

```bash
npm run lint
```

**期待結果**:
- ESLintのエラーが0件

---

## まとめ

すべてのステップが成功すれば、以下の要件が満たされています:

- ✅ FR-001: 後手はテラパゴス、ニャオハ、クワッス、ホゲータを使用
- ✅ FR-002: 後手のホゲータが敵陣最奥行に到達したとき、ラウドボーンに進化
- ✅ FR-003: 先手と後手で、ぞう役ときりん役の初期配置が左右反転
- ✅ FR-004: 各ポケモンの画像をPokeAPIから取得し、先手と後手の駒を視覚的に区別
- ✅ FR-005: 捕獲された駒は捕獲者の駒セットに変換
- ✅ FR-006: 先手と後手で異なるポケモンセットを使用しても、各役職の移動ルールは同一
- ✅ FR-007: 進化した駒が捕獲された場合、進化前の状態に戻し、捕獲者の駒セットに変換

---

## トラブルシューティング

### 画像が表示されない
- ネットワーク接続を確認
- DevToolsのConsoleでエラーを確認
- キャッシュをクリアして再試行

### 駒の変換が正しくない
- `src/utils/pieceConversion.ts` のロジックを確認
- `ROLE_TO_PIECE_MAP` と `PIECE_TO_ROLE_MAP` の定義を確認

### TypeScriptエラー
- `npm run build` でエラー詳細を確認
- 型定義が正しく拡張されているか確認
