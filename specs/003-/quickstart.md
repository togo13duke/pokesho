# Quickstart Guide - 後手駒の向き反転と視認性向上

**作成日**: 2025-10-04
**対象機能**: spec 003 - 後手駒の向き反転と視認性向上

## 機能概要

この機能は、ポケモン将棋の視認性を向上させるため、以下の3つの改善を実装します:

1. **後手駒の180度回転表示**: 対面プレイ時に後手プレイヤーが自分の駒を正しい向きで見られる
2. **移動方向マーカーの追加**: 全ての駒の周囲に移動可能方向を示す小さな三角形や点を常時表示
3. **ターン表示色の適用**: 盤面とメッセージエリアの背景色を現在のターンに応じて変化（先手: 薄い青、後手: 薄い赤）、手駒エリアは所有プレイヤーの色で常時表示

---

## セットアップ

### 前提条件

- Node.js 18以上
- npm 9以上
- 既存のポケモン将棋プロジェクトがクローン済み

### インストール

```bash
# 依存関係のインストール（既存プロジェクトで実施済みの場合はスキップ）
npm install

# 開発サーバーの起動
npm run dev
```

ブラウザで http://localhost:5173 にアクセス

---

## 動作確認手順

### 1. 後手駒の180度回転を確認

**手順**:
1. ゲームを開始する
2. 盤面上の後手（下側）の駒を確認する

**期待結果**:
- ✅ 後手の駒（プレイヤー2）がすべて上下逆向き（180度回転）で表示される
- ✅ 先手の駒（プレイヤー1）は通常の向きで表示される
- ✅ 駒の画像が回転してもクリック可能領域は正常

**検証コマンド**:
```bash
# ブラウザのDevToolsで確認
document.querySelectorAll('.rotate-180').length; // 後手の駒数（初期配置で4駒）
```

---

### 2. 移動方向マーカーを確認

**手順**:
1. 盤面上のすべての駒を目視で確認する

**期待結果**:
- ✅ すべての駒の周囲に移動可能方向を示す小さな三角形や点が表示される
- ✅ ピカチュウは6方向（前方3、左右、後方1）にマーカー表示
- ✅ フシギダネ/ゼニガメ/ヒトカゲは1方向（前方のみ）にマーカー表示
- ✅ リザードン（進化後）は6方向にマーカー表示
- ✅ マーカーが駒画像と明確に区別できる（色: グレー系、サイズ: 小さい）
- ✅ 後手の駒のマーカーも回転に合わせて正しい方向を指している

**検証コマンド**:
```bash
# ブラウザのDevToolsで確認
document.querySelectorAll('svg[aria-label*="移動可能"]').length; // 総マーカー数
```

---

### 3. ターン表示色を確認

**手順**:
1. ゲーム開始時（先手のターン）の盤面とメッセージエリアの背景色を確認
2. 先手が1手指す
3. 後手のターンに切り替わったときの背景色を確認

**期待結果**:
- ✅ 先手のターン時、盤面とメッセージエリアの背景色が薄い青（#E3F2FD / Tailwind `bg-blue-50`）
- ✅ 後手のターン時、盤面とメッセージエリアの背景色が薄い赤（#FFEBEE / Tailwind `bg-red-50`）
- ✅ ターン切り替え時に背景色が即座に変化する（遅延なし）
- ✅ テキストのコントラスト比が十分で読みやすい

**検証コマンド**:
```bash
# 先手ターン時
document.querySelector('.board').classList.contains('bg-blue-50'); // true
# 後手ターン時
document.querySelector('.board').classList.contains('bg-red-50'); // true
```

---

### 4. 手駒エリアの固定色を確認

**手順**:
1. ゲームを進めて、駒を1つ捕獲する
2. 先手と後手の手駒エリアを確認する
3. ターンを切り替えても手駒エリアの色が変わらないことを確認

**期待結果**:
- ✅ 先手の手駒エリアは常に薄い青（#E3F2FD）で表示される
- ✅ 後手の手駒エリアは常に薄い赤（#FFEBEE）で表示される
- ✅ ターンが切り替わっても手駒エリアの色は変わらない（盤面/メッセージエリアの色は変わる）
- ✅ 手駒の駒は現在の所有プレイヤーの向きで表示される（元の所有者の向きではない）

**検証方法**:
```bash
# 先手の手駒エリア
document.querySelector('[data-player="player1"].captured').classList.contains('bg-blue-50'); // true (常に)
# 後手の手駒エリア
document.querySelector('[data-player="player2"].captured').classList.contains('bg-red-50'); // true (常に)
```

---

### 5. 進化時の動作確認

**手順**:
1. ヒトカゲを相手陣地の最奥行まで進める（リザードンに進化）
2. 進化後の駒の向きとマーカーを確認

**期待結果**:
- ✅ 後手のヒトカゲが進化しても180度回転のまま
- ✅ リザードンの移動方向マーカーが6方向に増える
- ✅ マーカーも回転に合わせて正しい方向を指している

---

### 6. アクセシビリティ検証

**手順**:
1. スクリーンリーダー（macOS VoiceOver、Windows Narrator）を起動
2. 駒の上にフォーカスを移動

**期待結果**:
- ✅ 各移動方向マーカーに「[方向]に移動可能」のaria-labelが読み上げられる
- ✅ 駒画像のalt属性が適切に読み上げられる

**検証方法**:
```bash
# aria-labelの存在確認
document.querySelectorAll('svg[aria-label]').length > 0; // true
```

---

### 7. パフォーマンス検証

**手順**:
1. Chrome DevToolsを開く（F12）
2. Performanceタブを選択
3. 録画開始 → 駒を複数回移動 → 録画停止
4. FPS（フレームレート）を確認

**期待結果**:
- ✅ 駒の移動時のFPSが60を維持（16ms/frame以内）
- ✅ ターン切り替え時の再レンダリングが16ms以内
- ✅ 無駄な再レンダリングが発生していない（React DevTools Profiler確認）

**許容範囲**:
- 駒の移動: 16ms以内
- ターン切り替え: 即座（1フレーム以内）
- マーカー描画: 初回のみ（useMemoでキャッシュ）

---

## トラブルシューティング

### 駒が回転しない

**原因**: Tailwindの`rotate-180`クラスが適用されていない

**解決策**:
1. ブラウザのDevToolsで駒要素を確認
2. `className`に`rotate-180`が含まれているか確認
3. `piece.player === 'player2'` の条件が正しいか確認

### マーカーが表示されない

**原因**: SVG要素が生成されていない、または表示領域外

**解決策**:
1. `getPossibleMoveDirections` 関数が正しい方向を返すか確認
2. SVGの`position: absolute`が正しく設定されているか確認
3. `z-index`が駒画像より上に設定されているか確認

### 背景色が変わらない

**原因**: `currentTurn` propsが正しく渡されていない

**解決策**:
1. `useGameState`フックが`currentTurn`を正しく返すか確認
2. `Board.tsx`と`TurnDisplay.tsx`に`currentTurn` propsが渡されているか確認
3. Tailwindクラス名が動的に切り替わっているか確認（`bg-blue-50` ⇔ `bg-red-50`）

### パフォーマンスが低下する

**原因**: 無駄な再レンダリングが発生している

**解決策**:
1. `Piece`コンポーネントを`React.memo`でラップ
2. `getPossibleMoveDirections`の結果を`useMemo`でキャッシュ
3. React DevTools Profilerで再レンダリングの原因を特定

---

## 次のステップ

1. **テストの実行**: `npm run test` でcontract testsを実行
2. **ビルド確認**: `npm run build` でプロダクションビルドが成功するか確認
3. **プレビュー**: `npm run preview` でビルド後の動作を確認

---

## 関連ドキュメント

- [spec.md](./spec.md): 機能仕様書
- [research.md](./research.md): 技術調査結果
- [data-model.md](./data-model.md): データモデル定義
- [contracts/component-interface.md](./contracts/component-interface.md): コンポーネント契約
